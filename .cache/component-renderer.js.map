{"version":3,"sources":["../../src/cache-dir/component-renderer.js"],"names":["ComponentRenderer","props","state","location","pageResources","getResourcesForPathname","pathname","nextProps","setState","on","e","page","path","getPage","nextState","component","json","key","matchPath","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA;AACA;AACA;IACMA,iB;;;AACJ,6BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AAEjB,UAAKC,KAAL,GAAa;AACXC,gBAAUF,MAAME,QADL;AAEXC,qBAAe,iBAAOC,uBAAP,CAA+BJ,MAAME,QAAN,CAAeG,QAA9C;AAFJ,KAAb;AAFiB;AAMlB;;;;8CAEyBC,S,EAAW;AAAA;;AACnC,UAAI,KAAKL,KAAL,CAAWC,QAAX,CAAoBG,QAApB,KAAiCC,UAAUJ,QAAV,CAAmBG,QAAxD,EAAkE;AAChE,YAAMF,gBAAgB,iBAAOC,uBAAP,CACpBE,UAAUJ,QAAV,CAAmBG,QADC,CAAtB;AAGA,YAAI,CAACF,aAAL,EAAoB;AAClB;AACA;AACA;AACA,2BAAOC,uBAAP,CACEE,UAAUJ,QAAV,CAAmBG,QADrB,EAEE,yBAAiB;AACf,mBAAKE,QAAL,CAAc;AACZL,wBAAUI,UAAUJ,QADR;AAEZC;AAFY,aAAd;AAID,WAPH;AASD,SAbD,MAaO;AACL,eAAKI,QAAL,CAAc;AACZL,sBAAUI,UAAUJ,QADR;AAEZC;AAFY,WAAd;AAID;AACF;AACF;;;wCAEmB;AAAA;;AAClB;AACA;AACA;AACA,wBAAQK,EAAR,4BAAsC,aAAK;AACzC,YAAIC,EAAEC,IAAF,CAAOC,IAAP,KAAgB,iBAAOC,OAAP,CAAe,OAAKX,KAAL,CAAWC,QAAX,CAAoBG,QAAnC,EAA6CM,IAAjE,EAAuE;AACrE,iBAAKJ,QAAL,CAAc,EAAEJ,eAAeM,EAAEN,aAAnB,EAAd;AACD;AACF,OAJD;AAKD;;;0CAEqBG,S,EAAWO,S,EAAW;AAC1C;AACA,UACE,KAAKZ,KAAL,CAAWE,aAAX,CAAyBW,SAAzB,KAAuCD,UAAUV,aAAV,CAAwBW,SADjE,EAEE;AACA,eAAO,IAAP;AACD;AACD,UAAI,KAAKb,KAAL,CAAWE,aAAX,CAAyBY,IAAzB,KAAkCF,UAAUV,aAAV,CAAwBY,IAA9D,EAAoE;AAClE,eAAO,IAAP;AACD;AACD;AACA;AACA,UACE,KAAKd,KAAL,CAAWC,QAAX,CAAoBc,GAApB,KAA4BH,UAAUX,QAAV,CAAmBc,GAA/C,IACAH,UAAUV,aAAV,CAAwBO,IADxB,IAEAG,UAAUV,aAAV,CAAwBO,IAAxB,CAA6BO,SAH/B,EAIE;AACA,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD;;;6BAEQ;AACP,UAAI,KAAKhB,KAAL,CAAWE,aAAf,EAA8B;AAC5B,eAAO,0BAAc,KAAKF,KAAL,CAAWE,aAAX,CAAyBW,SAAvC;AACLE,eAAK,KAAKhB,KAAL,CAAWE,QAAX,CAAoBG;AADpB,WAEF,KAAKL,KAFH,EAGF,KAAKC,KAAL,CAAWE,aAAX,CAAyBY,IAHvB,EAAP;AAKD,OAND,MAMO;AACL,eAAO,IAAP;AACD;AACF;;;EA/E6B,gBAAMG,S;;kBAkFvBnB,iB","file":"component-renderer.js","sourcesContent":["import React, { createElement } from \"react\"\nimport loader from \"./loader\"\nimport emitter from \"./emitter\"\n\n// Pass pathname in as prop.\n// component will try fetching resources. If they exist,\n// will just render, else will render null.\nclass ComponentRenderer extends React.Component {\n  constructor(props) {\n    super()\n    this.state = {\n      location: props.location,\n      pageResources: loader.getResourcesForPathname(props.location.pathname),\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.state.location.pathname !== nextProps.location.pathname) {\n      const pageResources = loader.getResourcesForPathname(\n        nextProps.location.pathname\n      )\n      if (!pageResources) {\n        // Page resources won't be set in cases where the browser back button\n        // or forward button is pushed as we can't wait as normal for resources\n        // to load before changing the page.\n        loader.getResourcesForPathname(\n          nextProps.location.pathname,\n          pageResources => {\n            this.setState({\n              location: nextProps.location,\n              pageResources,\n            })\n          }\n        )\n      } else {\n        this.setState({\n          location: nextProps.location,\n          pageResources,\n        })\n      }\n    }\n  }\n\n  componentDidMount() {\n    // Listen to events so when our page gets updated, we can transition.\n    // This is only useful on delayed transitions as the page will get rendered\n    // without the necessary page resources and then re-render once those come in.\n    emitter.on(`onPostLoadPageResources`, e => {\n      if (e.page.path === loader.getPage(this.state.location.pathname).path) {\n        this.setState({ pageResources: e.pageResources })\n      }\n    })\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    // Check if the component or json have changed.\n    if (\n      this.state.pageResources.component !== nextState.pageResources.component\n    ) {\n      return true\n    }\n    if (this.state.pageResources.json !== nextState.pageResources.json) {\n      return true\n    }\n    // Check if location has changed on a page using internal routing\n    // via matchPath configuration.\n    if (\n      this.state.location.key !== nextState.location.key &&\n      nextState.pageResources.page &&\n      nextState.pageResources.page.matchPath\n    ) {\n      return true\n    }\n    return false\n  }\n\n  render() {\n    if (this.state.pageResources) {\n      return createElement(this.state.pageResources.component, {\n        key: this.props.location.pathname,\n        ...this.props,\n        ...this.state.pageResources.json,\n      })\n    } else {\n      return null\n    }\n  }\n}\n\nexport default ComponentRenderer\n"]}